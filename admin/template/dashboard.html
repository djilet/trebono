<div class="row">
	<section class="box no-margin">
		<header class="panel_header" for="header_dashboard" table="core">
			<h2 class="title"><TMPL_VAR NAME='LNG_Dashboard'></h2>
		</header>								
		<div class="content-body">
			<form action="<TMPL_VAR NAME='MODULE_URL'>" method="post" autocomplete="off">
				<div class="row">
					<div class="form-group">
						<div class="col-md-3 form-group">
							<label class="form-label"><TMPL_VAR NAME='LNG_DateFrom'></label>
							<input type="text" class="form-control datepicker" name="DateFrom" value="<TMPL_VAR NAME='DateFrom' FORMAT='datepicker'>">	
						</div>
						<div class="col-md-3 form-group">
							<label class="form-label"><TMPL_VAR NAME='LNG_DateTo'></label>
							<input type="text" class="form-control datepicker" name="DateTo" value="<TMPL_VAR NAME='DateTo' FORMAT='datepicker'>">
						</div>
						<div class="col-md-3 col-sm-2">
							<label class="form-label"><TMPL_VAR NAME='LNG_IncludeInvoices'></label>
							<select name="FilterInvoices" class="form-control">
								<option value=""><TMPL_VAR NAME='LNG_All'></option>
								<option value="future" <TMPL_IF NAME='FilterInvoices' VALUE='future'>selected</TMPL_IF>><TMPL_VAR NAME='LNG_Future'></option>
								<option value="past" <TMPL_IF NAME='FilterInvoices' VALUE='past'>selected</TMPL_IF>><TMPL_VAR NAME='LNG_Past'></option>
							</select>
						</div>
						<div class="col-md-2 form-group">
							<label class="form-label hidden-xs">&nbsp;</label><br />
							<button type="submit" class="btn btn-primary btn-icon"><i class="fa fa-search"></i> <TMPL_VAR NAME='LNG_FilterApply'></button>
						</div>
					</div>
				</div>
				<input class="hidden" name="Filter" value="1" />
			</form>
                
            <div class="row">
            
				<div class="col-md-4 col-sm-4 col-xs-4 padding-3">
					<section class="box ">
					    <header class="panel_header" for="header_dashboard_invoice_implemenation" table="core">
					        <h2 class="title pull-left"><TMPL_VAR NAME='LNG_InvoiceImplementationStatistics'></h2>
					        <div class="actions panel_actions pull-left">
					            <i class="box_toggle fa fa-chevron-down"></i>
					        </div>
					    </header>
					    <div class="content-body">
					        <div class="row">
						        <div class="col-md-12 col-sm-12 col-xs-12">
							        <TMPL_LOOP NAME='InvoiceImplementationStatistics'>
							            <div class="progress progress-lg">
			                                <div class="progress-bar progress-bar-<TMPL_VAR NAME='color_code'>" role="progressbar" aria-valuenow="<TMPL_VAR NAME='percent'>" aria-valuemin="0" aria-valuemax="100" style="width: <TMPL_VAR NAME='percent'>%">
			                                    <span class="bar-text"><TMPL_VAR NAME='title_translation'>: <TMPL_VAR NAME='cost' FORMAT='price'>€</span>
			                                </div>
			                            </div>
			                        </TMPL_LOOP>
						        </div>
					    	</div>
					    </div>
					</section>
				</div>
				
				<div class="col-md-4 col-sm-4 col-xs-4 padding-3">
					<section class="box ">
					    <header class="panel_header" for="header_dashboard_invoice_recurring" table="core">
					        <h2 class="title pull-left"><TMPL_VAR NAME='LNG_InvoiceRecurringStatistics'></h2>
					        <div class="actions panel_actions pull-left">
					            <i class="box_toggle fa fa-chevron-down"></i>
					        </div>
					    </header>
					    <div class="content-body">
					        <div class="row">
						        
						        <div class="col-md-12 col-sm-12 col-xs-12">
							        <TMPL_LOOP NAME='InvoiceRecurringStatistics'>
							            <div class="progress progress-lg">
			                                <div class="progress-bar progress-bar-<TMPL_VAR NAME='color_code'>" role="progressbar" aria-valuenow="<TMPL_VAR NAME='percent'>" aria-valuemin="0" aria-valuemax="100" style="width: <TMPL_VAR NAME='percent'>%">
			                                    <span class="bar-text"><TMPL_VAR NAME='title_translation'>: <TMPL_VAR NAME='cost' FORMAT='price'>€</span>
			                                </div>
			                            </div>
			                        </TMPL_LOOP>
						        </div>
					    	</div>
					    </div>
					</section>
				</div>

				<div class="col-md-4 col-sm-4 col-xs-4 padding-3">
					<section class="box ">
						<header class="panel_header" for="header_dashboard_voucher_invoice_recurring" table="core">
							<h2 class="title pull-left"><TMPL_VAR NAME='LNG_VoucherInvoiceRecurringStatistics'></h2>
							<div class="actions panel_actions pull-left">
								<i class="box_toggle fa fa-chevron-down"></i>
							</div>
						</header>
						<div class="content-body">
							<div class="row">

								<div class="col-md-12 col-sm-12 col-xs-12">
									<TMPL_LOOP NAME='VoucherInvoiceRecurringStatistics'>
										<div class="progress progress-lg">
											<div class="progress-bar progress-bar-<TMPL_VAR NAME='color_code'>" role="progressbar" aria-valuenow="<TMPL_VAR NAME='percent'>" aria-valuemin="0" aria-valuemax="100" style="width: <TMPL_VAR NAME='percent'>%">
												<span class="bar-text"><TMPL_VAR NAME='title_translation'>: <TMPL_VAR NAME='cost' FORMAT='price'>€</span>
											</div>
										</div>
									</TMPL_LOOP>
								</div>
							</div>
						</div>
					</section>
				</div>
				
			</div>
		</div>
	</section>
			
			<div class="row row-new">
				
				<section class="box no-margin">
				    <header class="panel_header" for="header_dashboard_status" table="core">
				        <h2 class="title pull-left"><TMPL_VAR NAME='LNG_StatusStatistics'></h2>
				        <div class="actions panel_actions pull-left">
				            <i class="box_toggle fa fa-chevron-down"></i>
				        </div>
				    </header>
				    <div class="content-body padding-3">    
				    	<div class="row row-new">
					    	<TMPL_LOOP NAME='StatusConversion'>
					            <div class="col-sm-4 padding-3">
									<section class="box ">
									    <header class="panel_header">
									        <h2 class="title"><TMPL_VAR NAME='status_from_translation'> -> <TMPL_VAR NAME='status_to_translation'></h2>
									    </header>
					    				<div class="content-body">    
						    				<div class="row">
						            			<div class="col-xs-12">
						            				<div class="tile-progress bg-primary">
	                                            		<div class="content">
			                                                <h4><TMPL_VAR NAME='LNG_Avg'></h4>
			                                                <span><TMPL_VAR NAME='avg_string'></span>
	                                            		</div>
	                                        		</div>
	                                        		
	                                        		<div class="tile-progress bg-success">
	                                            		<div class="content">
			                                                <a href="<TMPL_VAR NAME='ADMIN_PATH'>module.php?load=receipt&Section=receipt&receipt_id=<TMPL_VAR NAME='max_receipt_id'>">
			                                                	<h4 class="underline"><TMPL_VAR NAME='LNG_Min'></h4>
			                                               	</a>
			                                                <span><TMPL_VAR NAME='min_string'></span>
	                                            		</div>
	                                        		</div>
	                                        		
	                                        		
													<div class="tile-progress bg-danger">
	                                            		<div class="content">
	                                            			<a href="<TMPL_VAR NAME='ADMIN_PATH'>module.php?load=receipt&Section=receipt&receipt_id=<TMPL_VAR NAME='min_receipt_id'>">
				                                                <h4 class="underline"><TMPL_VAR NAME='LNG_Max'></h4>
				                                            </a>
				                                            <span ><TMPL_VAR NAME='max_string'></span>
	                                            		</div>
	                                        		</div>
						        				</div>
						        			</div>
						    			</div>
									</section>
					        	</div>
					        </TMPL_LOOP>
				    	</div>
				    </div>
				</section>
				
				<section class="box no-margin">
				    <header class="panel_header" for="header_dashboard_receipt_statistics" table="core">
				        <h2 class="title pull-left"><TMPL_VAR NAME='LNG_ReceiptStatistics'></h2>
				        <div class="actions panel_actions pull-left">
				            <i class="box_toggle fa fa-chevron-down"></i>
				        </div>
				    </header>
				    <div class="content-body">    
				    	<div class="row">
				    		<div class="col-sm-6">
				    			<div class="tile-counter bg-success">
                              		<div class="content">
	                                    <h2><TMPL_VAR NAME='ReceiptCount'></h2>
	                                    <span><TMPL_VAR NAME='LNG_Receipts'></span>
                              		</div>
                          		</div>
				    		</div>
				    		<div class="col-sm-6">
				    			<div class="tile-counter bg-orange">
                              		<div class="content">
	                                    <a id="show-denied-receipt-list" data-toggle="modal" data-target="#modal-denied-recept-list" href="">
		                                    <h2 class="underline-dashed"><TMPL_VAR NAME='ReceiptDeniedPercent'> %</h2>
		                                </a>
		                                <span><TMPL_VAR NAME='LNG_DeniedReceipts'></span>
                              		</div>
                          		</div>
				    		</div>
				    	</div>
				    </div>
				</section>

				<section class="box no-margin">
					<header class="panel_header" for="header_dashboard_employee_company" table="core">
						<h2 class="title pull-left"><TMPL_VAR NAME='LNG_EmployeeAndCompanyStatistics'></h2>
						<div class="actions panel_actions pull-left">
							<i class="box_toggle fa fa-chevron-down"></i>
						</div>
					</header>
					<div class="content-body">
						<div class="row">
							<div class="col-sm-6">
								<div class="tile-counter bg-success">
									<div class="content">
										<a id="show-added-company-unit-list" data-toggle="modal" data-target="#modal-entity-list" href="">
											<h2 class="underline-dashed"><TMPL_VAR NAME='CompanyUnitAddedCount'> <TMPL_VAR NAME='LNG_TotalCountSeparator'> <TMPL_VAR NAME='CompanyUnitTotalCount'></h2>
										</a>
										<span><TMPL_VAR NAME='LNG_CompanyUnitAdded' ESCAPE='none'></span>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="tile-counter bg-danger">
									<div class="content">
										<a id="show-deactivated-company-unit-list" data-toggle="modal" data-target="#modal-entity-list" href="">
											<h2 class="underline-dashed"><TMPL_VAR NAME='CompanyUnitDeactivatedCount'> <TMPL_VAR NAME='LNG_TotalCountSeparator'> <TMPL_VAR NAME='CompanyUnitArchiveTotalCount'></h2>
										</a>
										<span><TMPL_VAR NAME='LNG_CompanyUnitDeactivated' ESCAPE='none'></span>
									</div>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-6">
								<div class="tile-counter bg-success">
									<div class="content">
										<a id="show-added-employee-list" data-toggle="modal" data-target="#modal-entity-list" href="">
											<h2 class="underline-dashed"><TMPL_VAR NAME='EmployeeAddedCount'> <TMPL_VAR NAME='LNG_TotalCountSeparator'> <TMPL_VAR NAME='EmployeeTotalCount'></h2>
										</a>
										<span><TMPL_VAR NAME='LNG_EmployeeAdded' ESCAPE='none'></span>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="tile-counter bg-danger">
									<div class="content">
										<a id="show-deactivated-employee-list" data-toggle="modal" data-target="#modal-entity-list" href="">
											<h2 class="underline-dashed"><TMPL_VAR NAME='EmployeeDeactivatedCount'> <TMPL_VAR NAME='LNG_TotalCountSeparator'> <TMPL_VAR NAME='EmployeeArchiveTotalCount'></h2>
										</a>
										<span><TMPL_VAR NAME='LNG_EmployeeDeactivated' ESCAPE='none'></span>
									</div>
								</div>
							</div>
						</div>
					</div>
				</section>
				
			</div>		
						
		</div>											 

<div class="modal fade modal-wide-700" id="modal-denied-recept-list" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="ultraModal-Label" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
				<h4 class="modal-title"><TMPL_VAR NAME='LNG_ReceiptList'></h4>
			</div>
			<div class="modal-body">
				<TMPL_IF NAME='ReceiptDeniedList'>
					<form action="<TMPL_VAR NAME='PROJECT_PATH'>module/receipt/ajax.php" method="post" autocomplete="off" id="denied-receipt-filter">
						<div class="row">
							<div class="form-group">
								<div class="col-md-3 col-sm-2">
									<label class="form-label"><TMPL_VAR NAME='LNG_DenialReason'></label>
									<select name="FilterDenialReason" class="form-control">
										<option value=""><TMPL_VAR NAME='LNG_All'></option>
										<TMPL_LOOP NAME='DenialReasonSelectList'>
											<option value="<TMPL_VAR NAME='Reason'>"><TMPL_VAR NAME='Reason'></option>
										</TMPL_LOOP>
									</select>
								</div>
								<div class="col-md-3 col-sm-2">
									<label class="form-label"><TMPL_VAR NAME='LNG_Employee'></label>
									<select name="FilterEmployeeID" class="form-control">
										<option value=""><TMPL_VAR NAME='LNG_All'></option>
										<TMPL_LOOP NAME='EmployeeSelectList'>
											<option class="employee-select" value="<TMPL_VAR NAME='employee_id'>"><TMPL_VAR NAME='first_name'> <TMPL_VAR NAME='last_name'></option>
										</TMPL_LOOP>
									</select>
								</div>
								<div class="col-md-3 col-sm-2">
									<label class="form-label"><TMPL_VAR NAME='LNG_GroupBy'></label>
									<select name="GroupBy" class="form-control">
										<option value="">-</option>
										<option value="Employee"><TMPL_VAR NAME='LNG_Employee'></option>
										<option value="DenialReason"><TMPL_VAR NAME='LNG_DenialReason'></option>
									</select>
								</div>

								<div class="col-md-2 form-group">
									<label class="form-label hidden-xs">&nbsp;</label><br />
									<a href="#" class="btn btn-primary btn-icon" id="denied-receipt-filter-btn"><i class="fa fa-search"></i> <TMPL_VAR NAME='LNG_FilterApply'></a>
								</div>
							</div>
						</div>
						<input type="hidden" name="Action" value="GetDeniedReceiptListHTML">
						<TMPL_VAR NAME='ParamsForFilter' ESCAPE='none'>
					</form>
				
					<table class="table">
						<thead>
							<tr>
								<th><TMPL_VAR NAME='LNG_ReceiptID'/></th>
								<th><TMPL_VAR NAME='LNG_Created'/></th>
								<th><TMPL_VAR NAME="LNG_StatusUser"/></th>
								<th><TMPL_VAR NAME="LNG_Employee"/></th>
								<th><TMPL_VAR NAME="LNG_Service"/></th>
								<th><TMPL_VAR NAME='LNG_DenialReason'/></th>
							</tr>
						</thead>
						<tbody class="denied-receipt-list">
						</tbody>
					</table>
				<TMPL_ELSE>
					<div class="alert alert-success"><TMPL_VAR NAME='LNG_Empty'></div>
				</TMPL_IF>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-info" data-dismiss="modal"><TMPL_VAR NAME='LNG_Close'></button>
			</div>
		</div>
	</div>
</div>

<div class="modal fade modal-wide-700" id="modal-entity-list" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="ultraModal-Label" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
				<h4 class="modal-title" id="EnityModalTitle"></h4>
			</div>
			<div class="modal-body">
				<form action="<TMPL_VAR NAME='PROJECT_PATH'>module/company/ajax.php" method="post" autocomplete="off" id="entity-list-filter">
					<input type="hidden" name="Action" value="GetEntityListHTML">
					<TMPL_VAR NAME='ParamsForFilter' ESCAPE='none'>
				</form>
				<table class="table" id="TableEntityList">
					<thead>
					<tr>
						<th id="EmployeeURL"><TMPL_VAR NAME='LNG_EmployeeURL'/></th>
						<th id="CompanyUnitURL"><TMPL_VAR NAME='LNG_CompanyUnitURL'/></th>
						<th><TMPL_VAR NAME='LNG_ModifyDate'/></th>
						<th><TMPL_VAR NAME="LNG_ModifyUser"/></th>
					</tr>
					</thead>
					<tbody class="entity-list">
					</tbody>
				</table>
				<div class="alert alert-success" id="EmptyEntityList"><TMPL_VAR NAME='LNG_Empty'></div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-info" data-dismiss="modal"><TMPL_VAR NAME='LNG_Close'></button>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	$(document).ready(function(){
		
		$('#show-denied-receipt-list').click(function(e){
			LoadDeniedReceiptList();
		});	
				
		$('#denied-receipt-filter-btn').click(function(e){	
			LoadDeniedReceiptList();		
			e.preventDefault();
		});

		$('#show-added-company-unit-list').click(function(e){
            ShowEntityList("company-unit", "created");
        });
        $('#show-deactivated-company-unit-list').click(function(e){
            ShowEntityList("company-unit", "deactivated");

        });
        $('#show-added-employee-list').click(function(e){
            ShowEntityList("employee", "created");
        });
        $('#show-deactivated-employee-list').click(function(e){
            ShowEntityList("employee", "deactivated");
        });
	});
	
function LoadDeniedReceiptList(){
	
	var form = $('#denied-receipt-filter');
	var formData = form.serialize();

	$.ajax({
		url: form.attr('action'),
		type: 'POST',
		dataType: 'JSON',
		data: formData,
		success: function (data) {
			
			$('.employee-select').each(function(){
				$(this).text(data.DistinctEmployeeMap[$(this).val()]);
			});
			
			if (data.Status == "success") {
				$('.denied-receipt-list').html(data.HTML);
				$('#modal-denied-recept-list').modal('handleUpdate');
			} else {
				ModalAlert(GetTranslation("error"), data.Error);
			}
		}
	});
}

function ShowEntityList(entity, type)
{
    var tableContent = "";
    var adminPath = "<TMPL_VAR NAME='ADMIN_PATH'>";
    var id, userID, companyUnitID = 0;
    
    var form = $('#entity-list-filter');
	var formData = form.serializeArray();
	formData.push({ name: "Entity", value: entity });
	formData.push({ name: "Type", value: type });
	
	if (entity == "company-unit")
	{
	    $("#EmployeeURL").hide();
	    if (type == "created")
			$("#EnityModalTitle").html("<TMPL_VAR NAME='LNG_CompanyUnitAdded'>");
		else
            $("#EnityModalTitle").html("<TMPL_VAR NAME='LNG_CompanyUnitDeactivated'>");
	}
	else
	{
        $("#EmployeeURL").show();
        if (type == "created")
            $("#EnityModalTitle").html("<TMPL_VAR NAME='LNG_EmployeeAdded'>");
        else
            $("#EnityModalTitle").html("<TMPL_VAR NAME='LNG_EmployeeDeactivated'>");
	}

	$.ajax({
		url: form.attr('action'),
		type: 'GET',
		dataType: 'JSON',
		data: formData,
		success: function (data) {
			console.log(data);
			if (data.Status == "success") {				
				if(data.HTML != "") {
					$('.entity-list').html(data.HTML);
					$("#EmptyEntityList").hide();
				}else {
					$("#EmptyEntityList").show();
				}
				$('#modal-entity-list').modal('handleUpdate');
			} else {
				ModalAlert(GetTranslation("error"), data.Error);
			}
		}
	});
}

</script>
